<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pra Você, Amanda</title>
<style>
  :root{
    --accent1:#ff416c;
    --accent2:#ff4b2b;
    --glass: rgba(255,255,255,0.06);
    --text: #ffffff;
  }
  html,body{height:100%;margin:0;font-family: 'Segoe UI', system-ui, -apple-system, Roboto, 'Helvetica Neue', Arial;color:var(--text);overflow:hidden;}
  body{background:linear-gradient(135deg,#0f0c29 0%, #302b63 50%, #24243e 100%);display:flex;align-items:center;justify-content:center;}

  /* particles canvas covers entire screen */
  #bgCanvas{position:fixed;inset:0;z-index:0;display:block;}

  /* loader */
  #loader{position:fixed;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10;background:linear-gradient(180deg,rgba(0,0,0,0.85),rgba(0,0,0,0.95));backdrop-filter: blur(2px);transition:opacity 1.6s ease;}
  #loader.hidden{opacity:0;pointer-events:none;visibility:hidden;}
  #loader h1{letter-spacing:6px;font-size:34px;margin:0;color:rgba(255,255,255,0.95);}
  .progress{width:75%;max-width:860px;height:8px;background:rgba(255,255,255,0.06);border-radius:999px;margin-top:18px;overflow:hidden;}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));transition:width 6s linear;box-shadow:0 8px 30px rgba(255,75,75,0.15);}

  /* intro (Pronta?) */
  #intro{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:12;pointer-events:auto;opacity:0;transition:opacity 1s ease;}
  #intro.visible{opacity:1;}
  #intro h1{font-size:48px;margin:0 0 18px 0;text-shadow:0 8px 40px rgba(0,0,0,0.6);}
  #playBtn{appearance:none;border:0;padding:14px 36px;border-radius:28px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;font-size:18px;cursor:pointer;box-shadow:0 10px 40px rgba(255,65,108,0.18);display:inline-flex;align-items:center;gap:10px;transition:transform .25s ease;}
  #playBtn:active{transform:scale(.98);}

  #warning{margin-top:10px;opacity:.8;font-size:14px;}

  /* slideshow */
  #slideshow{position:fixed;inset:0;display:none;z-index:11;align-items:center;justify-content:center;overflow:hidden;padding:30px;box-sizing:border-box;}
  .slide{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:30px;box-sizing:border-box;opacity:0;transition:opacity 1.4s ease, transform 0.8s ease;}
  .slide.active{opacity:1;transform:none;z-index:2;}
  .slide img{max-width:78%;max-height:60vh;border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,0.6);object-fit:cover;}
  .text{max-width:940px;margin-top:24px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:18px 22px;border-radius:14px;backdrop-filter: blur(6px);font-size:20px;line-height:1.6;text-align:center;}

  /* nav arrows */
  .nav{position:fixed;top:50%;transform:translateY(-50%);font-size:44px;color:rgba(255,255,255,0.9);user-select:none;cursor:pointer;z-index:13;padding:8px 16px;border-radius:10px;background:rgba(0,0,0,0.18);backdrop-filter:blur(4px);}
  #prev{left:18px;} #next{right:18px;}

  /* hearts container (final slide) */
  #hearts{position:fixed;inset:0;pointer-events:none;z-index:9;overflow:hidden;display:none;}
  .heart{position:absolute;font-size:26px;opacity:0;transform:translateY(0) scale(0.8);transition:transform 2.4s cubic-bezier(.2,.9,.2,1),opacity 1.8s ease;filter:drop-shadow(0 8px 18px rgba(0,0,0,0.4));}

  /* typing cursor */
  .typing {border-right: .12em solid rgba(255,255,255,0.85);padding-right:6px;}

  /* responsive tweaks */
  @media(max-width:700px){
    #intro h1{font-size:34px;} .text{font-size:16px;padding:14px;} .slide img{max-width:92%;max-height:50vh;}
  }
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<!-- Loader -->
<div id="loader">
  <h1>Carregando...</h1>
  <div class="progress"><div class="bar" id="bar"></div></div>
</div>

<!-- Intro: Pronta? -->
<div id="intro" aria-hidden="false">
  <h1>Pronta?</h1>
  <button id="playBtn">▶ Play</button>
  <div id="warning">cuidado com o volume</div>
</div>

<!-- Hearts (for final slide) -->
<div id="hearts"></div>

<!-- Slideshow -->
<div id="slideshow" aria-hidden="true">
  <div class="nav" id="prev">&#10094;</div>
  <div class="nav" id="next">&#10095;</div>

  <div class="slide active" data-index="0">
    <img src="assets/foto1.jpeg" alt="foto 1">
    <div class="text">Amanda… nossa história começou lá no ensino fundamental. 7 ou 8 anos que não foram só tempo — foram capítulos que me fizeram quem eu sou.</div>
  </div>

  <div class="slide" data-index="1">
    <img src="assets/foto2.jpeg" alt="foto 2">
    <div class="text">Foram risadas no meio da aula, zoações, planos bobos e segredos sussurrados — momentos simples que hoje valem ouro pra mim.</div>
  </div>

  <div class="slide" data-index="2">
    <img src="assets/foto3.jpeg" alt="foto 3">
    <div class="text">Você esteve ao meu lado nas minhas falhas e nas minhas bobeiras. Mesmo quando eu não merecia, você ainda estava lá.</div>
  </div>

  <div class="slide" data-index="3">
    <img src="assets/foto4.jpeg" alt="foto 4">
    <div class="text">E dói saber que eu te fiz passar por coisas que não precisava. Isso pesa mais do que você imagina.</div>
  </div>

  <div class="slide" data-index="4">
    <img src="assets/foto5.jpeg" alt="foto 5">
    <div class="text">Nossa amizade é um dos meus bens mais preciosos. Eu não quero perder o que construímos em 7-8 anos.</div>
  </div>

  <div class="slide" data-index="5">
    <img src="assets/foto6.jpeg" alt="foto 6">
    <div class="text" id="finalText">Se eu pudesse voltar atrás, eu faria diferente. Mas posso prometer que farei melhor daqui pra frente.<br><br><strong id="apology">Me desculpa, Amanda. De verdade.</strong></div>
  </div>
</div>

<audio id="music" loop>
  <source src="assets/musica.mp3" type="audio/mpeg">
</audio>

<script>
/* -------------------- Utilities & assets -------------------- */
const bar = document.getElementById('bar');
const loader = document.getElementById('loader');
const intro = document.getElementById('intro');
const playBtn = document.getElementById('playBtn');
const slideshow = document.getElementById('slideshow');
const slides = Array.from(document.querySelectorAll('.slide'));
const prev = document.getElementById('prev');
const next = document.getElementById('next');
const music = document.getElementById('music');
const heartsLayer = document.getElementById('hearts');
let current = 0;
let slideInterval = null;

/* -------------------- Particles background -------------------- */
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let particles = [];
function resizeCanvas(){ canvas.width = innerWidth; canvas.height = innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function random(min,max){ return Math.random()*(max-min)+min; }

function initParticles(){
  particles = [];
  const count = Math.round((canvas.width * canvas.height) / 80000);
  for(let i=0;i<count;i++){
    particles.push({
      x: random(0,canvas.width),
      y: random(0,canvas.height),
      vx: random(-0.25,0.25),
      vy: random(-0.1,0.1),
      r: random(0.6,2.2),
      alpha: random(0.08,0.35)
    });
  }
}
initParticles();

function drawParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(const p of particles){
    p.x += p.vx;
    p.y += p.vy;
    if(p.x<0) p.x = canvas.width;
    if(p.x>canvas.width) p.x = 0;
    if(p.y<0) p.y = canvas.height;
    if(p.y>canvas.height) p.y = 0;
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,255,255,${p.alpha})`;
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();

/* -------------------- Loader -> Intro logic (fixed) -------------------- */
window.addEventListener('load', ()=>{
  setTimeout(()=>{ bar.style.width = '100%'; }, 120);
  // After progress completes show intro and then fully remove loader to avoid overlay issues
  setTimeout(()=>{
    intro.classList.add('visible'); // fade in the intro
    // hide loader after slight delay so transitions feel smooth
    setTimeout(()=>{ loader.classList.add('hidden'); loader.style.display='none'; }, 900);
  }, 6000);
});

/* -------------------- Play button: hide intro and start slideshow -------------------- */
playBtn.addEventListener('click', ()=>{
  // Try to play; some browsers may require user gesture (we have click so it's ok)
  music.play().catch(()=>{});
  // gracefully hide intro
  intro.classList.remove('visible');
  intro.style.pointerEvents = 'none';
  intro.style.opacity = 0;
  // After fade, remove intro from flow and show slideshow
  setTimeout(()=>{
    intro.style.display = 'none';
    slideshow.style.display = 'block';
    slideshow.setAttribute('aria-hidden','false');
    startSlides();
  }, 900);
});

/* -------------------- Slide controls & autoplay -------------------- */
function showSlide(i){
  slides[current].classList.remove('active');
  current = (i + slides.length) % slides.length;
  slides[current].classList.add('active');
  // if final slide -> trigger hearts + typing; else stop hearts
  if(current === slides.length - 1){
    startHearts();
    triggerTyping();
  } else {
    stopHearts();
    resetFinalText();
  }
}

next.addEventListener('click', ()=>{ showSlide(current+1); resetAutoplay(); });
prev.addEventListener('click', ()=>{ showSlide(current-1); resetAutoplay(); });

// swipe for mobile
let startX = null;
slideshow.addEventListener('touchstart', e=> startX = e.touches[0].clientX);
slideshow.addEventListener('touchend', e=>{
  if(startX === null) return;
  let diff = e.changedTouches[0].clientX - startX;
  if(diff > 60) { showSlide(current-1); resetAutoplay(); }
  if(diff < -60){ showSlide(current+1); resetAutoplay(); }
  startX = null;
});

function startSlides(){
  // ensure starting from current index (0)
  slides.forEach((s,idx)=> s.classList.toggle('active', idx===current));
  // autoplay interval (8s)
  slideInterval = setInterval(()=>{
    showSlide(current+1);
  }, 8000);
}

function resetAutoplay(){
  if(slideInterval) clearInterval(slideInterval);
  slideInterval = setInterval(()=>{ showSlide(current+1); }, 8000);
}

/* -------------------- Hearts effect for final slide -------------------- */
let heartsTimer = null;
function makeHeart(){
  const heart = document.createElement('div');
  heart.className = 'heart';
  heart.textContent = '❤';
  const size = Math.random()*18 + 18;
  heart.style.left = (Math.random()*90 + 5) + '%';
  heart.style.bottom = '-10%';
  heart.style.fontSize = `${size}px`;
  heart.style.opacity = 1;
  heartsLayer.appendChild(heart);
  // animate: translateY up and fade
  requestAnimationFrame(()=>{
    heart.style.transform = `translateY(-120vh) scale(1.1)`;
    heart.style.opacity = 0;
  });
  // cleanup
  setTimeout(()=>{ if(heart.parentNode) heart.parentNode.removeChild(heart); }, 2400);
}

function startHearts(){
  heartsLayer.style.display = 'block';
  if(heartsTimer) return;
  heartsTimer = setInterval(makeHeart, 420);
}

function stopHearts(){
  heartsLayer.style.display = 'none';
  if(heartsTimer){ clearInterval(heartsTimer); heartsTimer = null; }
  // remove any remaining hearts quickly
  heartsLayer.innerHTML = '';
}

/* -------------------- Typing effect for final apology text -------------------- */
const finalTextEl = document.getElementById('finalText');
const apologyEl = document.getElementById('apology');
let originalApology = apologyEl.textContent;
function resetFinalText(){
  apologyEl.textContent = originalApology;
  apologyEl.classList.remove('typing');
}

function triggerTyping(){
  // only type if not already typed
  apologyEl.textContent = '';
  apologyEl.classList.add('typing');
  const text = originalApology;
  let i = 0;
  const tick = ()=>{
    if(i < text.length){
      apologyEl.textContent += text[i++];
      setTimeout(tick, 45 + Math.random()*45);
    } else {
      apologyEl.classList.remove('typing');
    }
  };
  tick();
}

/* -------------------- Accessibility: keyboard navigation -------------------- */
document.addEventListener('keydown', (e)=>{
  if(slideshow.style.display !== 'block') return;
  if(e.key === 'ArrowRight') { showSlide(current+1); resetAutoplay(); }
  if(e.key === 'ArrowLeft')  { showSlide(current-1); resetAutoplay(); }
});

/* -------------------- Ensure intro elements visible (fix for reported bug) -------------------- */
// Guarantee visibility by forcing styles if needed after short delay
setTimeout(()=>{
  if(!intro.classList.contains('visible') && loader.classList.contains('hidden') === false){
    intro.classList.add('visible');
  }
  // ensure play button is not display:none or hidden by other reason
  playBtn.style.display = 'inline-flex';
  playBtn.style.visibility = 'visible';
}, 7000);

</script>
</body>
</html>
